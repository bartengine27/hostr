# inspired by https://stackoverflow.com/questions/30226113/ansible-ssh-prompt-known-hosts-issue
- name: "Configure the known_hosts file after init of the VMs/Containers on Azure, Proxmox, etc."
  hosts: localhost
  connection: local
  vars:
    ssh_known_hosts_command: "ssh-keyscan -T 10"
    ssh_known_hosts_file: "{{ lookup('env','HOME') + '/.ssh/known_hosts' }}"
    #ssh_known_hosts: "{{ groups['all'] }}"
    ssh_known_hosts: "{{ groups['all'] | difference( groups['firewall_public_ip'] ) }}"
  roles:
    - hostr.knownvmhosts